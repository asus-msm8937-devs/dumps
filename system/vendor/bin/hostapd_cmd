#!/system/bin/sh

LOG_TAG=hostapd_cmd

#record debug information to logcat log
logd () {
    /system/bin/log -t $LOG_TAG -p d "$@"
}

ACTION=`getprop persist.sys.wifi.hostapd.cmd`

log -t $LOG_TAG -p d hostapd_cmd enter

if [ "$ACTION" = "add_reload" -o "$ACTION" = "remove_reload" ]
then
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 begin
#hostapd_cli -iwlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set macaddr_acl 1
hostapd_cli -ictrl/wlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set macaddr_acl 1
#hostapd_cli -iwlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set accept_mac_file /data/misc/wifi/hostapd.accept
hostapd_cli -ictrl/wlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set accept_mac_file /data/misc/wifi/hostapd.accept
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 end
log -t $LOG_TAG -p d "$ACTION"
elif [ "$ACTION" = "unload" ]
then
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 begin
#hostapd_cli -iwlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set macaddr_acl 0
hostapd_cli -ictrl/wlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set macaddr_acl 0
#hostapd_cli -iwlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set deny_mac_file /data/misc/wifi/hostapd.deny
hostapd_cli -ictrl/wlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd set deny_mac_file /data/misc/wifi/hostapd.deny
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 end
log -t $LOG_TAG -p d "$ACTION"
elif [ "$ACTION" = "DISASSOCIATE" ]
then
TARGET=`getprop persist.sys.wifi.hostapd.target`
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 begin
#hostapd_cli -iwlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd $ACTION $TARGET
hostapd_cli -ictrl/wlan0 -p/data/misc/wifi/hostapd -s/data/misc/wifi/hostapd $ACTION $TARGET
#Modify by AMT.xiaohuang,4/18/2018,bug1184004 end
/system/bin/log -t $LOG_TAG -p d "$ACTION" "$TARGET"
fi

exit 0
